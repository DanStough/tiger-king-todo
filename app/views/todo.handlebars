<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark justify-content-between">
        <a class="navbar-brand mb-0 h1" href="#">üêÖ Tiger King TODO</a>

        <a class="navbar-link" href="/auth/logout">Logged in as {{name}}. Logout</a>
    {{!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button> --}}

    {{!-- <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Dropdown
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
            </div>
        </li>
        <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
        </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div> --}}
    </nav>

    <div class="container-lg">
        <h1>Tiger King TODO</h1>
        <form method="POST" action="{{url}}/todos">
            <div class="input-group mb-3">
                <input type="text" name="task" class="form-control" placeholder="Add TODO Here" aria-label="TODO Here" aria-describedby="button-addon2">
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit" value="Submit" id="button-addon2">Add Me</button>
                </div>
            </div>
        </form>

         <h1>TODO</h1>
         <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="text-align: center; width: 10%" scope="col">Completed</th>
                    <th scope="col">Task</th>
                    <th style="text-align: center; width: 10%" scope="col">Delete</th>
                </tr>
            </thead>
            <tbody>
                {{#each incompleteTodos}}
                 <tr>
                    <th style="text-align: center; width: 10%" scope="row">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridCheck" onclick="toggleTodo({{this.id}}, true)">
                        </div>
                    </th>
                    <td>{{this.task}}</td>
                    <td style="text-align: center; width: 10%">
                        <a onclick="deleteTodo({{this.id}})">
                            <svg class="bi bi-trash2-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.037 3.225l1.684 10.104A2 2 0 005.694 15h4.612a2 2 0 001.973-1.671l1.684-10.104C13.627 4.224 11.085 5 8 5c-3.086 0-5.627-.776-5.963-1.775z"/>
                            <path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z" clip-rule="evenodd"/>
                            </svg>
                        </a>
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>

         <h1>Completed Items</h1>
         <table class="table table-striped table-hover done">
            <thead>
                <tr>
                    <th style="text-align: center; width: 10%" scope="col">Completed</th>
                    <th scope="col">Task</th>
                    <th style="text-align: center; width: 10%" scope="col">Delete</th>
                </tr>
            </thead>
            <tbody>
                {{#each completedTodos}}
                 <tr>
                    <th style="text-align: center; width: 10%" scope="row">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridCheck" onclick="toggleTodo({{this.id}}, false)" checked>
                        </div>
                    </th>
                    <td>{{{this.task}}}</td>
                    <td style="text-align: center; width: 10%">
                        <a onclick="deleteTodo({{this.id}})">
                            <svg class="bi bi-trash2-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.037 3.225l1.684 10.104A2 2 0 005.694 15h4.612a2 2 0 001.973-1.671l1.684-10.104C13.627 4.224 11.085 5 8 5c-3.086 0-5.627-.776-5.963-1.775z"/>
                            <path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z" clip-rule="evenodd"/>
                            </svg>
                        </a>
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>

    </div>
    


</body>

<script>
    
    const toggleTodo = function(id, state) {
        const xhr = new XMLHttpRequest();
        xhr.open("PUT", '{{url}}/todos/' + id, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function() {
            if(xhr.readyState === XMLHttpRequest.DONE) {
                    const status = xhr.status;
                    if (status === 0 || (status >= 200 && status < 400)) {
                        // The request has been completed successfully
                        window.location.reload(true);
                    } else {
                        console.error('Could not update state for TOOD: ' + id)
                    }
                }
            }
        xhr.send(JSON.stringify({
            "id": id,
            "isCompleted": state
        }));
    }

    const deleteTodo = function(id) {
        const xhr = new XMLHttpRequest();
        xhr.open("DELETE", '{{url}}/todos/' + id, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function() {
            if(xhr.readyState === XMLHttpRequest.DONE) {
                    const status = xhr.status;
                    if (status === 0 || (status >= 200 && status < 400)) {
                        // The request has been completed successfully
                        window.location.replace(location.href);
                    } else {
                        console.error('Could not delete TOOD: ' + id)
                    }
                }
            }
        xhr.send();
    }

</script>
